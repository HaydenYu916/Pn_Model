# 集成优化流程系统需求文档

## 介绍

本系统旨在创建一个端到端的温室环境优化流程，集成机器学习预测模型、多目标优化算法和模型预测控制(MPC)仿真。该系统将自动化从模型训练到最优条件确定再到控制策略仿真的整个过程，为温室管理提供科学的决策支持。

## 需求

### 需求 1 - 光合作用预测模型训练

**用户故事：** 作为研究人员，我希望能够训练高精度的光合作用预测模型，以便准确预测不同环境条件下植物的光合效率。

#### 验收标准
1. 当运行ML_Framework的run_experiment.py时，系统应自动训练光合作用预测模型
2. 当模型训练完成时，系统应将模型保存到ML_Framework的results目录中
3. 当模型评估时，系统应提供准确的性能指标（R²、RMSE等）
4. 如果训练数据不足或有问题，系统应提供明确的错误信息

### 需求 2 - 多目标环境优化

**用户故事：** 作为温室管理员，我希望系统能够同时优化光照成本和光合作用效率，以便在经济效益和作物产量之间找到最佳平衡点。

#### 验收标准
1. 当运行pymoo文件夹中的find_optimal_conditions_multi_model.py时，系统应加载训练好的预测模型
2. 当优化过程运行时，系统应生成CLED成本函数并与光合作用模型结合进行多目标优化
3. 当优化完成时，系统应在results目录中保存完整的Pareto解集
4. 如果模型加载失败，系统应提供清晰的错误信息和恢复建议

### 需求 3 - 最优点确定与曲线拟合

**用户故事：** 作为决策者，我希望系统能够从Pareto解集中确定最优操作点，以便实施最有效的温室控制策略。

#### 验收标准
1. 当运行Optimal文件夹中的fit.py时，系统应加载优化生成的Pareto解集
2. 当拟合过程完成时，系统应确定最优的PPFD和R:B比例参数
3. 当分析完成时，系统应生成可视化图表展示最优解与其他解的对比
4. 如果Pareto解集数据不完整，系统应提供警告并尝试使用可用数据

### 需求 4 - MPC控制策略仿真

**用户故事：** 作为系统工程师，我希望能够使用确定的最优参数进行MPC控制仿真，以便验证控制策略的有效性。

#### 验收标准
1. 当将最优参数输入到mpc-farming-master系统时，系统应自动配置MPC控制器
2. 当仿真运行时，系统应模拟温室环境动态变化和控制响应
3. 当仿真完成时，系统应提供详细的性能评估报告
4. 如果仿真过程中出现异常，系统应安全终止并提供诊断信息

### 需求 5 - 流程自动化与集成

**用户故事：** 作为用户，我希望整个流程能够自动化执行，以便简化操作并提高效率。

#### 验收标准
1. 当启动集成流程时，系统应按顺序执行所有步骤而无需手动干预
2. 当一个步骤完成时，系统应自动开始下一个步骤并传递必要的数据
3. 当整个流程完成时，系统应生成综合报告总结所有步骤的结果
4. 如果任何步骤失败，系统应提供明确的错误信息并允许从失败点重新开始

### 需求 6 - 结果可视化与报告

**用户故事：** 作为管理者，我希望能够通过直观的图表和报告了解优化结果，以便做出明智的决策。

#### 验收标准
1. 当流程完成时，系统应生成包含所有关键结果的综合报告
2. 当查看结果时，系统应提供Pareto前沿、最优点和仿真性能的可视化图表
3. 当需要详细分析时，系统应允许交互式探索结果数据
4. 如果结果数据不完整，系统应在报告中明确标注缺失部分